(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.WireService={})})(this,function(a){"use strict";function b(a,b){return null!=b&&"undefined"!=typeof Symbol&&b[Symbol.hasInstance]?b[Symbol.hasInstance](a):a instanceof b}function c(a){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},c(a)}function d(a,b){a.forEach(function(a){var c=a.listener,d=a.statics,e=a.reactives,f=Object.create(null);if(e)for(var g=Object.keys(e),h=0,i=g.length;h<i;h++){var k=g[h],l=b[e[k]];f[k]=l}var m=Object.assign({},d,f);c.call(void 0,m)})}function e(a,b,c){c.mutated||(c.mutated=new Set,Promise.resolve().then(f.bind(void 0,a,c))),c.mutated.add(b)}function f(a,b){var c=new Set,e=b.mutated;delete b.mutated;var f;e.forEach(function(d){var e=g(a,d);if(b.values[d.reference]!==e){b.values[d.reference]=e,f=b.listeners[d.head];for(var h=0,j=f.length;h<j;h++)c.add(f[h])}}),d(c,b.values)}function g(a,b){var d=a[b.head];if(!b.tail)return d;for(var e,f=b.tail,g=0,h=f.length;g<h&&null!=d;g++){if(e=f[g],"object"!==c(d)||!(e in d))return;d=d[e]}return d}function h(a,b,c){var d=e.bind(void 0,a,b,c),f=j(a,b.head,d);Object.defineProperty(a,b.head,f)}function i(a,b,c){if(c=c||[],!a||-1<c.indexOf(a))return null;var d=Object.getOwnPropertyDescriptor(a,b);if(d)return d;var e=Object.getPrototypeOf(a);return e?(c.push(a),i(e,b,c)):null}function j(a,b,c){var d,e,f,g=i(a,b);if(null===g||g.get===void 0&&g.set===void 0){var h=a[b];d=!0,e=function(){return h},f=function(a){h=a,c()}}else{var j=g.set,k=g.get;d=g.enumerable,f=function(b){j&&j.call(a,b),c()},e=function(){return k?k.call(a):void 0}}return{set:f,get:e,enumerable:d,configurable:!0}}function k(a,b){var c=a.indexOf(b);-1<c&&a.splice(c,1)}function l(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c].listener===b)return void a.splice(c,1)}function m(a){if(!a.includes("."))return{reference:a,head:a};var b=a.split(".");return{reference:a,head:b.shift(),tail:b}}function n(a){for(var b=0,c=a.length;b<c;++b)a[b].call(void 0)}var o="updated",p="connected",q="disconnected",r="connect",s="disconnect",t="config",u=function(){function a(a,b,c,d,e){this._cmp=a,this._def=b,this._context=c,this._wireDef=d,this._wireTarget=e}return a.prototype.addEventListener=function(a,b){var c=this;switch(a){case r:var d=this._context["@wire"][p];d.push(b);break;case s:var f=this._context["@wire"][q];f.push(b);break;case t:var g=this._wireDef.params,i=this._wireDef.static,j=void 0;if(!g||0===(j=Object.keys(g)).length){var k=i||Object.create(null);return void b.call(void 0,k)}var l={listener:b,statics:i,reactives:g},n=this._context["@wire"][o];j.forEach(function(a){var b=m(g[a]),d=n.listeners[b.head];d?d.push(l):(d=[l],n.listeners[b.head]=d,h(c._cmp,b,n)),e(c._cmp,b,n)});break;default:throw new Error("unsupported event type "+a);}},a.prototype.removeEventListener=function(a,b){switch(a){case r:var c=this._context["@wire"][p];k(c,b);break;case s:var d=this._context["@wire"][q];k(d,b);break;case t:var e=this._context["@wire"][o].listeners,f=this._wireDef.params;f&&Object.keys(f).forEach(function(a){var c=m(f[a]),d=e[c.head];d&&l(d,b)});break;default:throw new Error("unsupported event type "+a);}},a.prototype.dispatchEvent=function(a){if(b(a,v)){var c=a.value;return this._wireDef.method?this._cmp[this._wireTarget](c):this._cmp[this._wireTarget]=c,!1}if("WireContextEvent"===a.type)return this._cmp.dispatchEvent(a);throw new Error("Invalid event "+a+".")},a}(),v=function(){return function(a){this.type="ValueChangedEvent",this.value=a}}(),w=new Map,x={wiring:function(a,b,c,d){var e=d["@wire"]=Object.create(null);e[p]=[],e[q]=[],e[o]={listeners:{},values:{}};for(var f=c.wire,g=Object.keys(f),h=function(b){var e=g[b],h=f[e],i=w.get(h.adapter);if(i){var j=new u(a,c,d,h,e);i({dispatchEvent:j.dispatchEvent.bind(j),addEventListener:j.addEventListener.bind(j),removeEventListener:j.removeEventListener.bind(j)})}},j=0,k=g.length;j<k;j++)h(j,k)},connected:function(a,b,c,d){var e;c.wire&&(e=d["@wire"][p])&&n(e)},disconnected:function(a,b,c,d){var e;c.wire&&(e=d["@wire"][q])&&n(e)}};a.registerWireService=function(a){a(x)},a.register=function(a,b){w.set(a,b)},a.ValueChangedEvent=v,Object.defineProperty(a,"__esModule",{value:!0})});
